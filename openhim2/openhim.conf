<VirtualHost *:80>
    ServerName openhim.kwunga.org
    Redirect permanent / https://openhim.kwunga.org/
</VirtualHost>

<VirtualHost *:443>
    ServerName openhim.kwunga.org
    SSLEngine on
    SSLCertificateFile /root/ssl_certs/certificate.crt
    SSLCertificateKeyFile /root/ssl_certs/certificate.key

    ProxyPreserveHost On

    # OpenHIM Console
    ProxyPass / http://localhost:9000/
    ProxyPassReverse / http://localhost:9000/

    # OpenHIM Core API
    ProxyPass /core https://localhost:5001/
    ProxyPassReverse /core https://localhost:5001/

    # WebSocket support (if needed)
    RewriteEngine On
    RewriteCond %{HTTP:Upgrade} websocket [NC]
    RewriteCond %{HTTP:Connection} upgrade [NC]
    RewriteRule ^/?(.*) "wss://localhost:5001/$1" [P,L]

    ErrorLog ${APACHE_LOG_DIR}/openhim_error.log
    CustomLog ${APACHE_LOG_DIR}/openhim_access.log combined
</VirtualHost>